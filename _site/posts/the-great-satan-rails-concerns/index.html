<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>The Great Satan - Rails Concerns - John McDowall</title>

    <meta name="author" content="John McDowall" />
    <meta name="description" content="Why ActiveSupport::Concern is a really bad thing." />

    <meta name="viewport" content="width=1000, maximum-scale=1.0, user-scalable=yes">

    <link rel="alternate" type="application/rss+xml" href="/atom.xml" />

    <link rel="stylesheet" href="/css/base.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />

    <link media="only screen and (max-device-width: 480px)" href="/css/iphone.css" type="text/css" rel="stylesheet" />
    <link media="only screen and (device-width: 768px)" href="/css/iphone.css" type="text/css" rel="stylesheet" />

    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.min.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Lora' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="/js/application.js"></script>
  </head>

  <body>
    <section id="page">
      <header>
        <section>
          <a href="/">
            <img src="/images/logo.png" srcset='/images/logo-hires.png 2x' alt='John McDowall'/>
          </a>

          <nav>
            <ul>
              <li><a href="/books.html">Books</a></li>
              <li><a href="/archive.html">Archive</a></li>
              <li><a href="https://github.com/johnmcdowall">Github</a></li>
              <li><a href="/atom.xml">RSS</a></li>
            </ul>
          </nav>
        </section>
      </header>

      <section class='content'>
        <article>
  <header>
    <h1>
      <a href="/posts/the-great-satan-rails-concerns">The Great Satan - Rails Concerns</a>
    </h1>

    <section class="byline">
      November  2, 2013
    </section>
  </header>

  <p>Corey Haines has already <a href="http://blog.coreyhaines.com/2012/12/why-i-dont-use-activesupportconcern.html">masterfully expounded</a> on why <code>ActiveSupport::Concern</code> will lead to you having a Real Bad Time - and you really should read it, but I wanted to write a quick cautionary tale to those thinking about using Concerns and highlight a couple of the more practical pains explicitly.</p>

<h2>The Headless Horseman</h2>

<p><code>ActiveSupport::Concern</code> may not have been intended to be used this way, but I see it used this way in a lot of Rails projects I&rsquo;ve worked on since the introduction of Concerns. I&rsquo;m talking about discorporated methods:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;active_support/concern&#39;</span>

<span class="k">module</span> <span class="nn">MonsterConcern</span>
  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>

  <span class="n">included</span> <span class="k">do</span>
    <span class="k">def</span> <span class="nf">can_fangs_be_seen_by_children?</span>
      <span class="n">nearby_children</span><span class="o">.</span><span class="n">can_see?</span><span class="p">(</span><span class="ss">:fangs</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">shaggy_monster</span>
      <span class="n">make_coat_type</span><span class="p">(</span><span class="ss">:shaggy</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">engage_rage</span>
      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">chew_bones</span>
      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>


<p>We have four disembodied methods here, stuck in a file. We get no indication of <em>whom</em> includes this file - if we&rsquo;re lucky the name might reflect that information, but it&rsquo;s still not exact. Where should we go to see where the <code>nearby_children</code> method is defined?</p>

<h2>The Goose Chase</h2>

<p>Let&rsquo;s say we want to look at the <code>make_coat_type</code> method. Where is it? It could be on the <code>Monster</code> model, but it&rsquo;s not. If we&rsquo;re lucky, maybe we spy a file called <code>monster_coat_type.rb</code>, but chances are it&rsquo;s bundled into something bigger. Eventually we find the appropriate method, but it&rsquo;s in another concern file that we didn&rsquo;t expect.</p>

<h2>Hunt and Peck</h2>

<p>New developers might look through a couple of files before they hit the thing they are looking for, because Concerns give no indication of what they contain at the file name level. Better developers will <code>grep</code> immediately, but even then they might waste time optimistically looking in a couple of file that seem likely first.</p>

<h2>Conclusion</h2>

<p><code>ActiveSupport::Concern</code> actually makes your code base worse. They make it:</p>

<ul>
<li><p>Harder to reason about the code you are currently reading. You must satisfy several mental dependencies before you can make any kind of informed change in the code you are looking at. This increased mental barrier also makes it more likely that a developer will make a mistake in the code they are changing inside a concern.</p></li>
<li><p>Harder to navigate the codebase. If I want to look at the <code>make_coat_type</code> method, I have to already know that it:</p>

<ul>
<li>Doesn&rsquo;t live on the main <code>Monster</code> model.</li>
<li>Is actually inside another file which contains a different <code>Concern</code></li>
</ul>
</li>
<li><p>Encourage a use of Modules that is just as bad as &lsquo;The Kitchen Drawer&rsquo; approach to using the <code>lib</code> directory that we know is bad, but this time it&rsquo;s at a much more fine grained line-of-code level.</p></li>
</ul>


<p>This is all symptomatic of the Rails world only now just coming to terms with some of the Domain Driven Design concepts of Services, and at the same time having the project leader stand behind a really badly thought out approach to handling complex large software projects.</p>

<p>Your Models don&rsquo;t deserve this fate - tearing methods away from them and placing them in the Phantom Zone that is ActiveSupport::Concerns. Give them and anyone who might read the code other than you a chance for a better life, and if you need further guidance, there&rsquo;s this <a href="http://blog.codeclimate.com/blog/2012/10/17/7-ways-to-decompose-fat-activerecord-models/">excellent CodeClimate post</a> which shows SEVEN ways not to use Concerns.</p>


  <section class="meta">
    <hr />
    <section class="copy">
      <div class="flag">
          <div class="flag__image">
              <a href="https://twitter.com/mrmcdowall"><img src="http://gravatar.com/avatar/493e6c6fc3f24eb73295548cfd136574?s=150" height="50" width="50" /></a>
          </div>
          <div class="flag__body">
              <p>I co-own and run <a href="http://kantan.io">Kantan</a>, a small CRO Optimization, software and product development studio in Vancouver, Canada. <a href="https://twitter.com/mrmcdowall">Follow me on Twitter</a>, or check out a book I wrote called <a href='https://leanpub.com/you-should-launch-with-less'>You Should Launch with less</a>.</p>
          </div>
      </div>
      <a href="http://twitter.com/share" class="twitter-share-button" data-count="none" data-via="mrmcdowall">Tweet</a>
      <a href="http://twitter.com/mrmcdowall" class="twitter-follow-button" data-show-count="false">Follow @mrmcdowall</a>
      <a href="http://news.ycombinator.com/submit" class="hn-share-button" data-title="The Great Satan - Rails Concerns" data-url="http://mcdowall.info//posts/the-great-satan-rails-concerns">Vote on HN</a>
      <script>
          (function(d, t) {
              var g = d.createElement(t),
                  s = d.getElementsByTagName(t)[0];
              g.src = '//hnbutton.appspot.com/static/hn.min.js';
              s.parentNode.insertBefore(g, s);
          }(document, 'script'));
      </script>
      <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    </section>
  </section>
</article>
      </section>

    </section>
    <footer>
      All Content Copyright &copy; 2014 - John McDowall
    </footer>
  </body>
</html>